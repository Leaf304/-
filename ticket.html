<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>è™šæ‹ŸæŠ¢ç¥¨ - ä¸‡äººIMAXå·¨å¹•å…</title>
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ç”µå½±é™¢é£æ ¼ï¼Œç§»åŠ¨ç«¯ä¼˜åŒ– */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }
        
        body {
            background-color: #f0f2f5;
            min-height: 100vh;
            padding: 0;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        /* å¯¼èˆªæ  */
        .navbar {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            background: #4361ee !important;
        }
        
        /* ä¸»å®¹å™¨ */
        .main-container {
            padding: 80px 15px 30px;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        /* ç”µå½±å¤§è§å¹• */
        .screen {
            background: linear-gradient(90deg, #333, #666, #333);
            margin: 0 auto 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            color: white;
            font-weight: bold;
            font-size: 1.3rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            max-width: 95%;
        }
        
        /* åŒºåŸŸé¢„è§ˆå¡ç‰‡ */
        .area-preview-container {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 15px;
            margin: 20px auto;
            max-width: 400px;
            padding: 10px;
        }
        
        .area-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 3px solid transparent;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .area-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .area-card.premium {
            border-color: #FFD700;
        }
        
        .area-card.vip {
            border-color: #C0C0C0;
        }
        
        .area-card.regular {
            border-color: #2ecc71;
        }
        
        .area-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
        }
        
        .area-icon.premium {
            background: linear-gradient(135deg, #FFD700, #FFA500);
        }
        
        .area-icon.vip {
            background: linear-gradient(135deg, #C0C0C0, #808080);
        }
        
        .area-icon.regular {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        
        .area-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
            color: #333;
        }
        
        .area-info {
            font-size: 0.85rem;
            color: #666;
        }
        
        /* åˆ†åŒºé¢„è§ˆ */
        .subarea-preview-container {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 12px;
            margin: 20px auto;
            max-width: 400px;
            padding: 10px;
        }
        
        .subarea-card {
            background: white;
            border-radius: 12px;
            padding: 18px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            transition: all 0.2s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .subarea-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.12);
        }
        
        .subarea-name {
            font-weight: bold;
            font-size: 1rem;
            margin-bottom: 8px;
            color: #333;
        }
        
        .subarea-info {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 8px;
        }
        
        .subarea-seats-preview {
            font-size: 0.75rem;
            color: #888;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 10px;
            display: inline-block;
        }
        
        /* åº§ä½å›¾å®¹å™¨ */
        .seat-map-container {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin: 15px auto;
            max-width: 95%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        .seat-map {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
            min-width: fit-content;
        }
        
        .seat-row {
            display: flex;
            justify-content: center;
            gap: 4px;
            margin-top: 2px;
        }
        
        /* åº§ä½æ ·å¼ */
        .seat {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 8px;
            font-weight: bold;
            color: white;
            user-select: none;
            border: 1px solid transparent;
        }
        
        .seat.available {
            background: #2ecc71;
            border-color: #27ae60;
        }
        
        .seat.selected {
            background: #e74c3c;
            border-color: #c0392b;
        }
        
        .seat.occupied {
            background: #95a5a6;
            border-color: #7f8c8d;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .seat.premium {
            border-color: #ffd700;
        }
        
        .seat.vip {
            border-color: #c0c0c0;
        }
        
        .seat.regular {
            border-color: #27ae60;
        }
        
        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            max-width: 95%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* å¯¼èˆªæ  */
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 10px;
        }
        
        .nav-title {
            font-weight: bold;
            font-size: 1.2rem;
            color: #333;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        
        .nav-btn {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }
        
        .nav-btn-primary {
            background: #4361ee;
            color: white;
        }
        
        .nav-btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .nav-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        /* åŒ…åœºæŒ‰é’® */
        .book-subarea-btn {
            background: linear-gradient(135deg, #4cc9f0, #4361ee);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
            width: 100%;
            max-width: 300px;
            margin: 15px auto;
            display: block;
        }
        
        .book-subarea-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }
        
        /* å·²é€‰åº§ä½æ˜¾ç¤º */
        .selected-seats-display {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
        }
        
        .seat-tag {
            display: inline-block;
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 15px;
            margin: 3px;
            font-size: 0.85rem;
        }
        
        /* æŒ‰é’®ç»„ */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            border: none;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 140px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .action-btn:active {
            transform: scale(0.98);
        }
        
        /* æ­¥éª¤æŒ‡ç¤ºå™¨ */
        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .step {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .step.active {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            box-shadow: 0 3px 10px rgba(67, 97, 238, 0.3);
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 480px) {
            .main-container {
                padding: 70px 10px 20px;
            }
            
            .area-preview-container,
            .subarea-preview-container {
                max-width: 100%;
                padding: 5px;
            }
            
            .area-card {
                padding: 15px;
                min-height: 120px;
            }
            
            .subarea-card {
                padding: 15px;
            }
            
            .seat {
                width: 22px;
                height: 22px;
                font-size: 7px;
            }
            
            .screen {
                font-size: 1.1rem;
                padding: 12px;
            }
            
            .action-btn {
                padding: 10px 20px;
                font-size: 0.9rem;
                min-width: 130px;
            }
            
            .book-subarea-btn {
                padding: 10px 16px;
                font-size: 0.9rem;
                max-width: 280px;
            }
        }
        
        @media (min-width: 768px) {
            .area-preview-container {
                grid-template-columns: repeat(3, 1fr);
                max-width: 900px;
                gap: 20px;
            }
            
            .subarea-preview-container {
                grid-template-columns: repeat(3, 1fr);
                max-width: 900px;
                gap: 20px;
            }
            
            .seat {
                width: 26px;
                height: 26px;
                font-size: 9px;
            }
            
            .area-card {
                min-height: 160px;
            }
        }
        
        /* é¡µé¢å®¹å™¨ */
        .page-container {
            display: none;
        }
        
        .page-container.active {
            display: block;
        }
        
        /* ç¡®è®¤å’Œé—¨ç¥¨é¡µé¢ */
        .confirmation-section, .ticket-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px auto;
            max-width: 95%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: none;
        }
        
        .confirmation-section.active, .ticket-section.active {
            display: block;
        }
        
        .ticket-preview {
            border: 2px dashed #4361ee;
            border-radius: 15px;
            padding: 20px;
            background: #f8f9ff;
        }
        
        /* åˆ†åŒºæ ‡è¯† */
        .section-divider {
            text-align: center;
            margin: 25px 0 15px;
            position: relative;
        }
        
        .section-divider:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #dee2e6;
            z-index: 1;
        }
        
        .section-divider span {
            background: white;
            padding: 0 15px;
            position: relative;
            z-index: 2;
            color: #666;
            font-weight: bold;
        }
        
        /* ç©ºçŠ¶æ€æç¤º */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#" onclick="goToHomePage()">
                <i class="fas fa-film me-2"></i>ä¸‡äººIMAXå·¨å¹•å…
            </a>
            <div class="navbar-text text-white">
                <span id="currentStepText">åŒºåŸŸé€‰æ‹©</span>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="main-container">
        <!-- ç”µå½±å¤§è§å¹• -->
        <div class="screen">
            ğŸ¬ ä¸‡äººIMAXå·¨å¹•å… (10080åº§ä½) ğŸ¬
        </div>

        <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
        <div class="step-indicator">
            <div class="step active" id="step1">1</div>
            <div class="step" id="step2">2</div>
            <div class="step" id="step3">3</div>
            <div class="step" id="step4">4</div>
        </div>

        <!-- ========== é¡µé¢1ï¼šåŒºåŸŸé€‰æ‹© ========== -->
        <div id="pageAreaSelect" class="page-container active">
            <h3 class="text-center mb-3 text-dark">è¯·é€‰æ‹©è§‚çœ‹åŒºåŸŸ</h3>
            <p class="text-center text-muted mb-4">ç‚¹å‡»åŒºåŸŸæŸ¥çœ‹åˆ†åŒº</p>
            
            <div class="area-preview-container" id="areaPreview">
                <!-- åŒºåŸŸå¡ç‰‡ä¼šé€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="action-buttons">
                <button class="action-btn btn-secondary" onclick="goToHomePage()">
                    <i class="fas fa-home me-2"></i>è¿”å›é¦–é¡µ
                </button>
            </div>
        </div>

        <!-- ========== é¡µé¢2ï¼šåˆ†åŒºé€‰æ‹© ========== -->
        <div id="pageSubareaSelect" class="page-container">
            <div class="top-nav">
                <button class="nav-btn nav-btn-secondary" onclick="goToAreaSelect()">
                    <i class="fas fa-arrow-left"></i> è¿”å›
                </button>
                <div class="nav-title" id="currentAreaTitle"></div>
                <button class="nav-btn nav-btn-primary" onclick="goToHomePage()">
                    <i class="fas fa-home"></i> é¦–é¡µ
                </button>
            </div>
            
            <h4 class="text-center mb-3">é€‰æ‹©åˆ†åŒºï¼ˆç‚¹å‡»åˆ†åŒºæŸ¥çœ‹åº§ä½ï¼‰</h4>
            
            <div class="subarea-preview-container" id="subareaPreview">
                <!-- åˆ†åŒºå¡ç‰‡ä¼šé€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <!-- åº§ä½é¢„è§ˆå›¾ -->
            <div class="section-divider">
                <span>åº§ä½é¢„è§ˆ</span>
            </div>
            
            <div class="seat-map-container">
                <div class="seat-map" id="seatPreviewMap">
                    <!-- åº§ä½é¢„è§ˆä¼šåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <p class="text-center text-muted small mt-2">
                    <i class="fas fa-info-circle me-1"></i>ç‚¹å‡»åˆ†åŒºå¡ç‰‡æŸ¥çœ‹å…·ä½“åº§ä½
                </p>
            </div>
        </div>

        <!-- ========== é¡µé¢3ï¼šåº§ä½é€‰æ‹© ========== -->
        <div id="pageSeatSelect" class="page-container">
            <div class="top-nav">
                <button class="nav-btn nav-btn-secondary" onclick="goToSubareaSelect()">
                    <i class="fas fa-arrow-left"></i> è¿”å›
                </button>
                <div class="nav-title" id="currentSubareaTitle"></div>
                <button class="nav-btn nav-btn-primary" onclick="goToHomePage()">
                    <i class="fas fa-home"></i> é¦–é¡µ
                </button>
            </div>
            
            <!-- åŒ…åœºæŒ‰é’® -->
            <button class="book-subarea-btn" id="bookSubareaBtn">
                <i class="fas fa-crown me-2"></i>åŒ…ä¸‹æ­¤åˆ†åŒº
            </button>
            
            <!-- åº§ä½å›¾ -->
            <div class="seat-map-container">
                <div class="seat-map" id="seatMap">
                    <!-- å…·ä½“åº§ä½ä¼šåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="control-panel">
                <!-- å·²é€‰åº§ä½ -->
                <div class="selected-seats-display">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <strong>å·²é€‰åº§ä½ï¼š</strong>
                        <span id="selectedCount">0</span>
                    </div>
                    <div id="selectedSeatsList">
                        <!-- å·²é€‰åº§ä½æ ‡ç­¾ä¼šåŠ¨æ€æ·»åŠ  -->
                    </div>
                </div>
                
                <!-- ä»·æ ¼å’Œæ“ä½œ -->
                <div class="mt-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0">æ€»è®¡ï¼š</h5>
                        <h3 class="text-success mb-0" id="totalPrice">0 å…ƒ</h3>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="action-btn btn-danger" onclick="clearSelection()">
                            <i class="fas fa-times me-1"></i>æ¸…ç©ºé€‰æ‹©
                        </button>
                        <button class="action-btn btn-primary" id="confirmBtn" onclick="confirmSelection()" disabled>
                            <i class="fas fa-check me-1"></i>ç¡®è®¤é€‰æ‹©
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- åº§ä½å›¾ä¾‹ -->
            <div class="row justify-content-center mt-3">
                <div class="col-auto">
                    <div class="d-flex align-items-center mb-2">
                        <div class="seat me-2 available"></div>
                        <span>å¯é€‰åº§ä½</span>
                    </div>
                </div>
                <div class="col-auto">
                    <div class="d-flex align-items-center mb-2">
                        <div class="seat me-2 selected"></div>
                        <span>å·²é€‰åº§ä½</span>
                    </div>
                </div>
                <div class="col-auto">
                    <div class="d-flex align-items-center mb-2">
                        <div class="seat me-2 occupied"></div>
                        <span>å·²å”®åº§ä½</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== é¡µé¢4ï¼šç¡®è®¤é¡µé¢ ========== -->
        <div class="confirmation-section" id="confirmationSection">
            <h3 class="text-center mb-4"><i class="fas fa-clipboard-check me-2"></i>ç¡®è®¤è´­ç¥¨ä¿¡æ¯</h3>
            
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                è¿™æ˜¯è™šæ‹Ÿè´­ç¥¨æ¼”ç¤ºï¼Œä¸ä¼šçœŸå®æ‰£æ¬¾ã€‚
            </div>
            
            <div class="text-center py-4">
                <h4>åº§ä½æ•°é‡ï¼š<span id="confirmSeatCount" class="text-primary">--</span> ä¸ª</h4>
                <h4>åº§ä½å·ï¼š<span id="confirmSeats" class="text-primary">--</span></h4>
                <h4 class="mt-3">æ€»ä»·ï¼š<span id="confirmPrice" class="text-success">-- å…ƒ</span></h4>
            </div>
            
            <div class="action-buttons">
                <button class="action-btn btn-secondary" onclick="backToSeatSelection()">
                    <i class="fas fa-arrow-left me-1"></i>è¿”å›é€‰åº§
                </button>
                <button class="action-btn btn-success" onclick="proceedToPayment()">
                    <i class="fas fa-credit-card me-1"></i>æ¨¡æ‹Ÿæ”¯ä»˜
                </button>
            </div>
        </div>

        <!-- ========== é¡µé¢5ï¼šé—¨ç¥¨é¡µé¢ ========== -->
        <div class="ticket-section" id="ticketSection">
            <div class="ticket-preview">
                <div class="text-center mb-4">
                    <h2 class="text-primary">ğŸ« è™šæ‹Ÿè§‚å½±ç¥¨</h2>
                    <p class="text-muted">çºªå¿µç”µå­ç¥¨</p>
                </div>
                
                <div class="row">
                    <div class="col-md-8">
                        <h4>ã€Šè™šæ‹Ÿè§‚å½±ä½“éªŒã€‹</h4>
                        <p><i class="fas fa-calendar me-2"></i>æ—¶é—´ï¼š<span id="ticketDate">2024å¹´6æœˆ1æ—¥ 19:30</span></p>
                        <p><i class="fas fa-film me-2"></i>å½±å…ï¼šä¸‡äººIMAXå·¨å¹•å…</p>
                        <p><i class="fas fa-chair me-2"></i>åº§ä½ï¼š<span id="ticketSeats" class="fw-bold">--</span></p>
                        <p><i class="fas fa-tag me-2"></i>æ€»ä»·ï¼š<span id="ticketPrice" class="fw-bold">-- å…ƒ</span></p>
                        <p class="small text-muted mt-3">ç¥¨å·ï¼š<span id="ticketNumber">TICKET-001</span></p>
                    </div>
                    <div class="col-md-4 text-center">
                        <div style="width:120px;height:120px;background:#333;border-radius:10px;margin:0 auto;display:flex;align-items:center;justify-content:center;color:white;">
                            <div>
                                <i class="fas fa-qrcode fa-3x"></i>
                                <p class="small mb-0 mt-2">æ‰«ç éªŒç¥¨</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-4 pt-3 border-top">
                    <p class="fst-italic text-success" id="ticketMessage">"æ„Ÿè°¢æ”¯æŒï¼Œç¥è§‚å½±æ„‰å¿«ï¼"</p>
                </div>
            </div>
            
            <div class="action-buttons mt-4">
                <button class="action-btn btn-primary" onclick="saveTicket()">
                    <i class="fas fa-download me-1"></i>ä¿å­˜é—¨ç¥¨
                </button>
                <button class="action-btn btn-secondary" onclick="goToHomePage()">
                    <i class="fas fa-home me-1"></i>è¿”å›é¦–é¡µ
                </button>
            </div>
        </div>
    </div>

    <script>
        // ==================== é…ç½®æ•°æ® ====================
        const config = {
            "totalSeats": 10080,
            "rows": 120,
            "baseSeatsPerRow": 20,
            "colIncrement": 0.7,
            "hallName": "ä¸‡äººIMAXå·¨å¹•å…",
            "areas": [
                { 
                    "name": "å‰æ’ä¼˜é€‰åŒº", 
                    "rowRange": [1, 20], 
                    "type": "premium", 
                    "price": 120 
                },
                { 
                    "name": "ä¸­æ’VIPåŒº", 
                    "rowRange": [21, 60], 
                    "type": "vip", 
                    "price": 90 
                },
                { 
                    "name": "åæ’æ™®é€šåŒº", 
                    "rowRange": [61, 120], 
                    "type": "regular", 
                    "price": 60 
                }
            ],
            "subAreas": [
                // å‰æ’ä¼˜é€‰åŒº - 3ä¸ªåˆ†åŒº
                { 
                    "area": "premium", 
                    "subId": "P1", 
                    "name": "å‰æ’å·¦åŒº", 
                    "rowRange": [1, 7], 
                    "colRange": [1, 8], 
                    "capacity": 56 
                },
                { 
                    "area": "premium", 
                    "subId": "P2", 
                    "name": "å‰æ’ä¸­åŒº", 
                    "rowRange": [1, 7], 
                    "colRange": [9, 16], 
                    "capacity": 56 
                },
                { 
                    "area": "premium", 
                    "subId": "P3", 
                    "name": "å‰æ’å³åŒº", 
                    "rowRange": [8, 14], 
                    "colRange": [1, 8], 
                    "capacity": 56 
                },
                // ä¸­æ’VIPåŒº - 3ä¸ªåˆ†åŒº
                { 
                    "area": "vip", 
                    "subId": "V1", 
                    "name": "ä¸­æ’å·¦åŒº", 
                    "rowRange": [21, 35], 
                    "colRange": [1, 10], 
                    "capacity": 150 
                },
                { 
                    "area": "vip", 
                    "subId": "V2", 
                    "name": "ä¸­æ’ä¸­åŒº", 
                    "rowRange": [21, 35], 
                    "colRange": [11, 20], 
                    "capacity": 150 
                },
                { 
                    "area": "vip", 
                    "subId": "V3", 
                    "name": "ä¸­æ’å³åŒº", 
                    "rowRange": [36, 50], 
                    "colRange": [1, 10], 
                    "capacity": 150 
                },
                // åæ’æ™®é€šåŒº - 3ä¸ªåˆ†åŒº
                { 
                    "area": "regular", 
                    "subId": "R1", 
                    "name": "åæ’å·¦åŒº", 
                    "rowRange": [61, 80], 
                    "colRange": [1, 12], 
                    "capacity": 240 
                },
                { 
                    "area": "regular", 
                    "subId": "R2", 
                    "name": "åæ’ä¸­åŒº", 
                    "rowRange": [61, 80], 
                    "colRange": [13, 24], 
                    "capacity": 240 
                },
                { 
                    "area": "regular", 
                    "subId": "R3", 
                    "name": "åæ’å³åŒº", 
                    "rowRange": [81, 100], 
                    "colRange": [1, 12], 
                    "capacity": 240 
                }
            ],
            "aisles": [5, 10, 15],
            "disabledSeatsPercentage": 1,
            "price": {
                "premium": 120,
                "vip": 90,
                "regular": 60
            }
        };

        // ==================== åº”ç”¨çŠ¶æ€ ====================
        const appState = {
            currentPage: 'areaSelect', // areaSelect, subareaSelect, seatSelect, confirmation, ticket
            currentArea: null,
            currentSubarea: null,
            selectedSeats: new Set(),
            bookedSeats: new Set(),
            currentPrice: 0,
            seatPrice: config.price,
            
            // å½“å‰æ˜¾ç¤ºçš„åº§ä½æ•°æ®
            seatMapData: []
        };

        // ==================== åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ä¸‡äººIMAXå·¨å¹•å…é€‰åº§ç³»ç»ŸåŠ è½½å®Œæˆ');
            initApp();
        });

        function initApp() {
            // ç”ŸæˆåŒºåŸŸé¢„è§ˆ
            renderAreaPreview();
            
            // ç»‘å®šåŒ…åœºæŒ‰é’®äº‹ä»¶
            document.getElementById('bookSubareaBtn').addEventListener('click', bookCurrentSubarea);
            
            // åˆå§‹åŒ–é—¨ç¥¨æ—¥æœŸ
            updateTicketInfo();
            
            console.log('åº”ç”¨åˆå§‹åŒ–å®Œæˆ');
        }

        // ==================== é¡µé¢å¯¼èˆª ====================
        function showPage(pageId) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page-container').forEach(page => {
                page.classList.remove('active');
            });
            
            // éšè—ç¡®è®¤å’Œé—¨ç¥¨é¡µé¢
            document.getElementById('confirmationSection').classList.remove('active');
            document.getElementById('ticketSection').classList.remove('active');
            
            // æ˜¾ç¤ºç›®æ ‡é¡µé¢
            const targetPage = document.getElementById(`page${pageId}`);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
            updateStepIndicator(pageId);
            
            // æ›´æ–°å¯¼èˆªæ–‡æœ¬
            updateCurrentStepText(pageId);
            
            appState.currentPage = pageId;
        }

        function updateStepIndicator(pageId) {
            const steps = {
                'AreaSelect': 1,
                'SubareaSelect': 2,
                'SeatSelect': 3,
                'confirmation': 4,
                'ticket': 4
            };
            
            const currentStep = steps[pageId] || 1;
            
            document.querySelectorAll('.step').forEach((step, index) => {
                step.classList.remove('active');
                if (index < currentStep) {
                    step.classList.add('active');
                }
            });
        }

        function updateCurrentStepText(pageId) {
            const texts = {
                'AreaSelect': 'åŒºåŸŸé€‰æ‹©',
                'SubareaSelect': 'åˆ†åŒºé€‰æ‹©',
                'SeatSelect': 'åº§ä½é€‰æ‹©',
                'confirmation': 'ç¡®è®¤ä¿¡æ¯',
                'ticket': 'é—¨ç¥¨'
            };
            
            document.getElementById('currentStepText').textContent = texts[pageId] || 'åŒºåŸŸé€‰æ‹©';
        }

        // ==================== é¦–é¡µåŠŸèƒ½ ====================
        function goToHomePage() {
            // é‡ç½®çŠ¶æ€
            appState.currentArea = null;
            appState.currentSubarea = null;
            appState.selectedSeats.clear();
            
            // æ˜¾ç¤ºåŒºåŸŸé€‰æ‹©é¡µé¢
            showPage('AreaSelect');
            
            // æ¸…ç©ºé€‰æ‹©æ˜¾ç¤º
            updateSelectionDisplay();
        }

        function goToAreaSelect() {
            showPage('AreaSelect');
        }

        // ==================== åŒºåŸŸé€‰æ‹© ====================
        function renderAreaPreview() {
            const container = document.getElementById('areaPreview');
            container.innerHTML = '';
            
            config.areas.forEach(area => {
                const areaCard = document.createElement('div');
                areaCard.className = `area-card ${area.type}`;
                areaCard.onclick = () => selectArea(area.type);
                
                // è®¡ç®—åˆ†åŒºæ•°é‡
                const subareaCount = config.subAreas.filter(s => s.area === area.type).length;
                const rowCount = area.rowRange[1] - area.rowRange[0] + 1;
                
                areaCard.innerHTML = `
                    <div class="area-icon ${area.type}">
                        ${area.type === 'premium' ? 'P' : area.type === 'vip' ? 'V' : 'R'}
                    </div>
                    <div class="area-name">${area.name}</div>
                    <div class="area-info">
                        <div>${subareaCount}ä¸ªåˆ†åŒº</div>
                        <div>${rowCount}æ’åº§ä½</div>
                        <div class="fw-bold mt-1">Â¥${area.price}èµ·/åº§</div>
                    </div>
                `;
                
                container.appendChild(areaCard);
            });
        }

        function selectArea(areaType) {
            const area = config.areas.find(a => a.type === areaType);
            if (!area) return;
            
            appState.currentArea = area;
            
            // æ›´æ–°æ ‡é¢˜
            document.getElementById('currentAreaTitle').textContent = area.name;
            
            // æ¸²æŸ“åˆ†åŒºé¢„è§ˆ
            renderSubareaPreview(areaType);
            
            // ç”Ÿæˆåº§ä½é¢„è§ˆå›¾
            generateSeatPreview(area);
            
            // æ˜¾ç¤ºåˆ†åŒºé€‰æ‹©é¡µé¢
            showPage('SubareaSelect');
        }

        // ==================== åˆ†åŒºé€‰æ‹© ====================
        function renderSubareaPreview(areaType) {
            const container = document.getElementById('subareaPreview');
            container.innerHTML = '';
            
            const subareas = config.subAreas.filter(s => s.area === areaType);
            
            subareas.forEach(subarea => {
                const card = document.createElement('div');
                card.className = 'subarea-card';
                card.onclick = () => selectSubarea(subarea.subId);
                
                card.innerHTML = `
                    <div class="subarea-name">${subarea.name}</div>
                    <div class="subarea-info">
                        <div>${subarea.rowRange[0]}-${subarea.rowRange[1]}æ’</div>
                        <div>çº¦${subarea.capacity}ä¸ªåº§ä½</div>
                    </div>
                    <div class="subarea-seats-preview">
                        ${subarea.colRange[0]}-${subarea.colRange[1]}åˆ—
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function generateSeatPreview(area) {
            const container = document.getElementById('seatPreviewMap');
            container.innerHTML = '';
            
            const [startRow, endRow] = area.rowRange;
            const previewRows = Math.min(8, endRow - startRow + 1); // æœ€å¤šæ˜¾ç¤º8æ’é¢„è§ˆ
            
            // è®¡ç®—æ˜¾ç¤ºçš„æ’æ•°ï¼ˆç­‰æ¯”ç¼©ç•¥ï¼‰
            const rowStep = Math.ceil((endRow - startRow + 1) / previewRows);
            
            for (let i = 0; i < previewRows; i++) {
                const rowNum = startRow + i * rowStep;
                if (rowNum > endRow) break;
                
                const arcRow = document.createElement('div');
                arcRow.className = 'seat-row';
                
                const rowCols = Math.floor(config.baseSeatsPerRow + (rowNum - 1) * config.colIncrement);
                const previewCols = Math.min(15, rowCols); // æœ€å¤šæ˜¾ç¤º15åˆ—
                const colStep = Math.ceil(rowCols / previewCols);
                
                for (let j = 0; j < previewCols; j++) {
                    const colNum = 1 + j * colStep;
                    if (colNum > rowCols) break;
                    
                    // è·³è¿‡è¿‡é“
                    if (config.aisles.includes(colNum)) continue;
                    
                    const seat = document.createElement('div');
                    seat.className = `seat ${area.type} available`;
                    seat.style.opacity = '0.7';
                    seat.style.width = '18px';
                    seat.style.height = '18px';
                    seat.style.fontSize = '6px';
                    
                    arcRow.appendChild(seat);
                }
                
                container.appendChild(arcRow);
            }
        }

        function goToSubareaSelect() {
            if (appState.currentArea) {
                showPage('SubareaSelect');
            } else {
                goToAreaSelect();
            }
        }

        // ==================== åº§ä½é€‰æ‹© ====================
        function selectSubarea(subareaId) {
            const subarea = config.subAreas.find(s => s.subId === subareaId);
            if (!subarea || !appState.currentArea) return;
            
            appState.currentSubarea = subarea;
            
            // æ›´æ–°æ ‡é¢˜
            document.getElementById('currentSubareaTitle').textContent = 
                `${appState.currentArea.name} - ${subarea.name}`;
            
            // ç”Ÿæˆåº§ä½å›¾
            generateSeatMap(subarea);
            
            // æ¸…ç©ºä¹‹å‰çš„é€‰æ‹©
            appState.selectedSeats.clear();
            updateSelectionDisplay();
            
            // æ˜¾ç¤ºåº§ä½é€‰æ‹©é¡µé¢
            showPage('SeatSelect');
        }

        function generateSeatMap(subarea) {
            const container = document.getElementById('seatMap');
            container.innerHTML = '';
            
            const [startRow, endRow] = subarea.rowRange;
            const [startCol, endCol] = subarea.colRange;
            
            // ç”Ÿæˆå·²å”®åº§ä½
            const bookedSeats = new Set();
            const totalSeats = (endRow - startRow + 1) * (endCol - startCol + 1);
            const bookedCount = Math.ceil(totalSeats * (config.disabledSeatsPercentage / 100));
            
            for (let i = 0; i < bookedCount; i++) {
                const randomRow = startRow + Math.floor(Math.random() * (endRow - startRow + 1));
                const randomCol = startCol + Math.floor(Math.random() * (endCol - startCol + 1));
                bookedSeats.add(`R${randomRow}-C${randomCol}`);
            }
            
            appState.bookedSeats = bookedSeats;
            appState.seatMapData = [];
            
            // ç”Ÿæˆåº§ä½
            for (let row = startRow; row <= endRow; row++) {
                const arcRow = document.createElement('div');
                arcRow.className = 'seat-row';
                arcRow.dataset.row = row;
                
                const rowCols = Math.floor(config.baseSeatsPerRow + (row - 1) * config.colIncrement);
                
                for (let col = startCol; col <= endCol; col++) {
                    if (col > rowCols) continue; // ç¡®ä¿åˆ—æ•°ä¸è¶…è¿‡è¯¥æ’æ€»åˆ—æ•°
                    
                    // è·³è¿‡è¿‡é“
                    if (config.aisles.includes(col)) continue;
                    
                    const seatId = `R${row}-C${col}`;
                    const seat = document.createElement('div');
                    seat.className = `seat ${appState.currentArea.type}`;
                    seat.dataset.seatId = seatId;
                    seat.dataset.row = row;
                    seat.dataset.col = col;
                    seat.textContent = col;
                    
                    // æ£€æŸ¥æ˜¯å¦å·²å”®
                    if (bookedSeats.has(seatId)) {
                        seat.classList.add('occupied');
                        seat.title = `å·²å”® ${row}æ’${col}åº§`;
                    } else {
                        seat.classList.add('available');
                        seat.onclick = () => toggleSeat(seatId);
                        seat.title = `${row}æ’${col}åº§`;
                    }
                    
                    arcRow.appendChild(seat);
                    appState.seatMapData.push({
                        id: seatId,
                        row: row,
                        col: col,
                        element: seat
                    });
                }
                
                container.appendChild(arcRow);
            }
            
            console.log(`ç”Ÿæˆ ${subarea.name} åº§ä½å›¾ï¼Œ${endRow - startRow + 1}æ’ Ã— ${endCol - startCol + 1}åˆ—`);
        }

        // ==================== åŒ…åœºåŠŸèƒ½ ====================
        function bookCurrentSubarea() {
            if (!appState.currentSubarea) return;
            
            const subarea = appState.currentSubarea;
            const areaName = appState.currentArea.name;
            
            if (!confirm(`ç¡®å®šè¦åŒ…ä¸‹ã€Œ${subarea.name}ã€çš„æ‰€æœ‰å¯ç”¨åº§ä½å—ï¼Ÿ\n\n` +
                        `åˆ†åŒºï¼š${areaName} - ${subarea.name}\n` +
                        `åº§ä½èŒƒå›´ï¼š${subarea.rowRange[0]}-${subarea.rowRange[1]}æ’ï¼Œ${subarea.colRange[0]}-${subarea.colRange[1]}åˆ—`)) {
                return;
            }
            
            // å…ˆæ¸…ç©ºå½“å‰é€‰æ‹©
            clearSelection();
            
            // é€‰æ‹©è¯¥åˆ†åŒºæ‰€æœ‰å¯ç”¨åº§ä½
            let selectedCount = 0;
            appState.seatMapData.forEach(seat => {
                if (!appState.bookedSeats.has(seat.id)) {
                    appState.selectedSeats.add(seat.id);
                    seat.element.classList.add('selected');
                    seat.element.classList.remove('available');
                    selectedCount++;
                }
            });
            
            // æ›´æ–°æ˜¾ç¤º
            updateSelectionDisplay();
            
            alert(`ğŸ‰ æˆåŠŸåŒ…ä¸‹ã€Œ${subarea.name}ã€ï¼\nå·²é€‰æ‹© ${selectedCount} ä¸ªåº§ä½ã€‚`);
        }

        // ==================== åº§ä½é€‰æ‹©åŠŸèƒ½ ====================
        function toggleSeat(seatId) {
            if (appState.selectedSeats.has(seatId)) {
                appState.selectedSeats.delete(seatId);
            } else {
                appState.selectedSeats.add(seatId);
            }
            
            updateSelectionDisplay();
        }

        function updateSelectionDisplay() {
            const selectedCount = appState.selectedSeats.size;
            const totalPrice = calculateTotalPrice();
            
            // æ›´æ–°è®¡æ•°
            document.getElementById('selectedCount').textContent = selectedCount;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('confirmBtn').disabled = selectedCount === 0;
            
            // æ›´æ–°ä»·æ ¼
            document.getElementById('totalPrice').textContent = totalPrice + ' å…ƒ';
            appState.currentPrice = totalPrice;
            
            // æ›´æ–°å·²é€‰åº§ä½åˆ—è¡¨
            const listContainer = document.getElementById('selectedSeatsList');
            listContainer.innerHTML = '';
            
            appState.selectedSeats.forEach(seatId => {
                const match = seatId.match(/R(\d+)-C(\d+)/);
                if (match) {
                    const tag = document.createElement('span');
                    tag.className = 'seat-tag';
                    tag.textContent = `${match[1]}æ’${match[2]}åº§`;
                    listContainer.appendChild(tag);
                }
            });
            
            // æ›´æ–°åº§ä½è§†è§‰çŠ¶æ€
            if (appState.seatMapData) {
                appState.seatMapData.forEach(seat => {
                    if (appState.bookedSeats.has(seat.id)) {
                        // å·²å”®åº§ä½ä¿æŒä¸å˜
                        return;
                    }
                    
                    if (appState.selectedSeats.has(seat.id)) {
                        seat.element.classList.add('selected');
                        seat.element.classList.remove('available');
                    } else {
                        seat.element.classList.remove('selected');
                        seat.element.classList.add('available');
                    }
                });
            }
        }

        function calculateTotalPrice() {
            if (!appState.currentArea) return 0;
            
            const pricePerSeat = appState.seatPrice[appState.currentArea.type];
            const selectedCount = appState.selectedSeats.size;
            
            let total = pricePerSeat * selectedCount;
            
            // åŒ…åœºä¼˜æƒ ï¼ˆé€‰æ‹©è¶…è¿‡50ä¸ªåº§ä½ï¼‰
            if (selectedCount > 50) {
                total *= 0.8; // 8æŠ˜ä¼˜æƒ 
            }
            
            return Math.round(total);
        }

        function clearSelection() {
            appState.selectedSeats.clear();
            updateSelectionDisplay();
        }

        // ==================== ç¡®è®¤å’Œæ”¯ä»˜ ====================
        function confirmSelection() {
            if (appState.selectedSeats.size === 0) {
                alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªåº§ä½ï¼');
                return;
            }
            
            // æ›´æ–°ç¡®è®¤é¡µé¢ä¿¡æ¯
            const seatIds = Array.from(appState.selectedSeats);
            const displaySeats = seatIds.map(seatId => {
                const match = seatId.match(/R(\d+)-C(\d+)/);
                return match ? `${match[1]}æ’${match[2]}åº§` : seatId;
            }).join(', ');
            
            document.getElementById('confirmSeatCount').textContent = appState.selectedSeats.size;
            document.getElementById('confirmSeats').textContent = displaySeats;
            document.getElementById('confirmPrice').textContent = appState.currentPrice + ' å…ƒ';
            
            // æ˜¾ç¤ºç¡®è®¤é¡µé¢
            document.getElementById('confirmationSection').classList.add('active');
            document.querySelectorAll('.page-container').forEach(page => {
                page.classList.remove('active');
            });
            
            updateStepIndicator('confirmation');
            updateCurrentStepText('confirmation');
        }

        function backToSeatSelection() {
            // éšè—ç¡®è®¤é¡µé¢
            document.getElementById('confirmationSection').classList.remove('active');
            
            // æ˜¾ç¤ºåº§ä½é€‰æ‹©é¡µé¢
            showPage('SeatSelect');
        }

        function proceedToPayment() {
            // æ›´æ–°é—¨ç¥¨ä¿¡æ¯
            const seatIds = Array.from(appState.selectedSeats);
            const displaySeats = seatIds.map(seatId => {
                const match = seatId.match(/R(\d+)-C(\d+)/);
                return match ? `${match[1]}æ’${match[2]}åº§` : seatId;
            }).join(', ');
            
            document.getElementById('ticketSeats').textContent = displaySeats;
            document.getElementById('ticketPrice').textContent = appState.currentPrice + ' å…ƒ';
            
            // ç”Ÿæˆç¥¨å·
            const now = new Date();
            const ticketNumber = 'TICKET-' + 
                now.getFullYear() + 
                (now.getMonth() + 1).toString().padStart(2, '0') + 
                now.getDate().toString().padStart(2, '0') + '-' + 
                Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            document.getElementById('ticketNumber').textContent = ticketNumber;
            
            // éšè—ç¡®è®¤é¡µé¢ï¼Œæ˜¾ç¤ºé—¨ç¥¨é¡µé¢
            document.getElementById('confirmationSection').classList.remove('active');
            document.getElementById('ticketSection').classList.add('active');
            
            updateStepIndicator('ticket');
            updateCurrentStepText('ticket');
            
            alert('ğŸ‰ æ”¯ä»˜æˆåŠŸï¼é—¨ç¥¨å·²ç”Ÿæˆã€‚');
        }

        function saveTicket() {
            alert('âœ… é—¨ç¥¨å·²ä¿å­˜åˆ°æœ¬åœ°ï¼ˆæ¨¡æ‹ŸåŠŸèƒ½ï¼‰');
        }

        // ==================== è¾…åŠ©å‡½æ•° ====================
        function updateTicketInfo() {
            const now = new Date();
            const eventDate = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
            const formattedDate = `${eventDate.getFullYear()}å¹´${eventDate.getMonth() + 1}æœˆ${eventDate.getDate()}æ—¥ 19:30`;
            document.getElementById('ticketDate').textContent = formattedDate;
        }

        // ==================== å¯¼å‡ºåˆ°å…¨å±€ ====================
        window.goToHomePage = goToHomePage;
        window.goToAreaSelect = goToAreaSelect;
        window.goToSubareaSelect = goToSubareaSelect;
        window.selectArea = selectArea;
        window.selectSubarea = selectSubarea;
        window.bookCurrentSubarea = bookCurrentSubarea;
        window.toggleSeat = toggleSeat;
        window.clearSelection = clearSelection;
        window.confirmSelection = confirmSelection;
        window.backToSeatSelection = backToSeatSelection;
        window.proceedToPayment = proceedToPayment;
        window.saveTicket = saveTicket;
    </script>
</body>
</html>
